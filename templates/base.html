<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriveX | Premium Rentals</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    {% if not hide_nav %}
    <nav class="navbar">
        <div class="logo"><i class="fas fa-car-side"></i> Drive<span>X</span></div>
        <div class="nav-links">
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('fleet') }}">Cars</a>
            <a href="{{ url_for('about') }}">About Us</a>
            
            {% if current_user.is_authenticated %}
                {% if current_user.is_admin %}
                    <a href="{{ url_for('admin_dashboard') }}" style="color: #ffc107; font-weight: bold; border: 1px solid #ffc107; padding: 5px 10px; border-radius: 4px;">
                        <i class="fas fa-crown"></i> Admin Panel
                    </a>
                {% endif %}
                <a href="{{ url_for('dashboard') }}"><i class="fas fa-user-circle"></i> {{ current_user.name }}</a>
                <a href="{{ url_for('logout') }}" class="btn-login" style="background: #dc3545; margin-left: 10px;">Logout</a>
            {% else %}
                <a href="{{ url_for('login') }}" class="btn-login">Login</a>
            {% endif %}
            
            <button id="darkModeToggle" style="background:none; border:none; cursor:pointer; font-size:1.2rem; margin-left:15px;">üåô</button>
        </div>
    </nav>
    {% endif %}

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div style="text-align: center; background: #333; color: #fff; padding: 10px;">{{ messages[0] }}</div>
        {% endif %}
    {% endwith %}

    <div style="flex: 1;">
        {% block content %}{% endblock %}
    </div>

    <footer>
        <div style="text-align: center; color: #aaa;">&copy; 2026 DriveX Technologies. All rights reserved.</div>
    </footer>

    <div class="chatbot-btn" onclick="toggleChat()">üí¨</div>
    <div class="chatbot-window" id="chatWindow">
        <div class="chat-header">Support Chat <span style="cursor:pointer" onclick="toggleChat()">&times;</span></div>
        <div class="chat-body" id="chatBody">
            <div class="msg-bot">Hi! I'm DriveBot. Ask me about prices, docs, or booking!</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" placeholder="Type a message..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        function toggleChat() {
            var chat = document.getElementById('chatWindow');
            chat.style.display = chat.style.display === 'flex' ? 'none' : 'flex';
        }

        function handleEnter(e) { if(e.key === 'Enter') sendMessage(); }

        function sendMessage() {
            var input = document.getElementById('chatInput');
            var msg = input.value.trim();
            if(!msg) return;

            var chatBody = document.getElementById('chatBody');
            chatBody.innerHTML += `<div class="msg-user">${msg}</div>`;
            input.value = '';
            chatBody.scrollTop = chatBody.scrollHeight;

            fetch('/chatbot', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({message: msg})
            })
            .then(response => response.json())
            .then(data => {
                chatBody.innerHTML += `<div class="msg-bot">${data.response}</div>`;
                chatBody.scrollTop = chatBody.scrollHeight;
            });
        }

        // Dark Mode Logic
        const toggle = document.getElementById('darkModeToggle');
        const body = document.body;
        if(localStorage.getItem('dark-mode') === 'enabled'){ body.classList.add('dark-mode'); toggle.innerText = '‚òÄÔ∏è'; }
        toggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            if(body.classList.contains('dark-mode')){
                localStorage.setItem('dark-mode', 'enabled'); toggle.innerText = '‚òÄÔ∏è';
            } else {
                localStorage.setItem('dark-mode', 'disabled'); toggle.innerText = 'üåô';
            }
        });
    </script>
</body>
</html>
