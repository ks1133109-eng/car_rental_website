<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriveX | Premium Rentals</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    {% if not hide_nav %}
    <nav class="navbar">
        <a href="{{ url_for('home') }}" class="logo"><i class="fas fa-car-side"></i> Drive<span>X</span></a>
        <div class="nav-links">
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('fleet') }}">Cars</a>
            <a href="{{ url_for('about') }}">About</a>
            
            {% if current_user.is_authenticated %}
                {% if current_user.is_admin %}
                    <a href="{{ url_for('admin_dashboard') }}" style="color: #f59e0b;">Admin</a>
                {% endif %}
                <a href="{{ url_for('dashboard') }}">{{ current_user.name }}</a>
                <a href="{{ url_for('logout') }}" class="btn-login" style="background: #ef4444;">Logout</a>
            {% else %}
                <a href="{{ url_for('login') }}" class="btn-login">Login</a>
            {% endif %}
            
            <button id="darkModeToggle" style="background:none; border:none; cursor:pointer; font-size:1.2rem; margin-left:15px; color: var(--text-main);">üåô</button>
        </div>
    </nav>
    {% endif %}

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div style="text-align: center; background: #2563eb; color: #fff; padding: 10px;">{{ messages[0] }}</div>
        {% endif %}
    {% endwith %}

    <div style="flex: 1;">
        {% block content %}{% endblock %}
    </div>

    <footer>
        <div style="text-align: center; font-size: 0.9rem; color: #64748b;">
            &copy; 2026 DriveX Technologies. All rights reserved.
        </div>
    </footer>

    <div class="chatbot-btn" onclick="toggleChat()">üí¨</div>
    
    <div class="chatbot-window" id="chatWindow">
        <div class="chat-header">
            DriveX Support 
            <span style="cursor:pointer" onclick="toggleChat()">&times;</span>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="msg-bot">üëã Hi! I can help with booking, prices, or documents.</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" placeholder="Ask a question..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script>
        function toggleChat() {
            var chat = document.getElementById('chatWindow');
            chat.style.display = chat.style.display === 'flex' ? 'none' : 'flex';
        }

        function handleEnter(e) {
            if(e.key === 'Enter') sendMessage();
        }

        function sendMessage() {
            var input = document.getElementById('chatInput');
            var msg = input.value.trim();
            if(!msg) return;

            // 1. Add User Message
            var chatBody = document.getElementById('chatBody');
            chatBody.innerHTML += `<div class="msg-user">${msg}</div>`;
            input.value = '';
            chatBody.scrollTop = chatBody.scrollHeight;

            // 2. Show "Typing..." (Optional visual)
            
            // 3. Send to Python Backend
            fetch('/chatbot', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({message: msg})
            })
            .then(response => response.json())
            .then(data => {
                // 4. Add Bot Response
                chatBody.innerHTML += `<div class="msg-bot">${data.response}</div>`;
                chatBody.scrollTop = chatBody.scrollHeight;
            })
            .catch(error => {
                console.error('Error:', error);
                chatBody.innerHTML += `<div class="msg-bot">‚ö†Ô∏è Sorry, I'm having trouble connecting. Try again later.</div>`;
            });
        }

        // Dark Mode Logic (Persist Selection)
        const toggle = document.getElementById('darkModeToggle');
        const body = document.body;
        
        if(localStorage.getItem('dark-mode') === 'enabled'){
            body.classList.add('dark-mode');
            toggle.innerText = '‚òÄÔ∏è';
        }

        toggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            if(body.classList.contains('dark-mode')){
                localStorage.setItem('dark-mode', 'enabled');
                toggle.innerText = '‚òÄÔ∏è';
            } else {
                localStorage.setItem('dark-mode', 'disabled');
                toggle.innerText = 'üåô';
            }
        });
    </script>
</body>
</html>
