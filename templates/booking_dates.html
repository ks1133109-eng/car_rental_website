{% extends "base.html" %}
{% block content %}
<div style="padding: 40px 10%; background: #f8f9fa; min-height: 90vh;">
    
    <div style="background: white; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); overflow: hidden; display: flex; flex-wrap: wrap;">
        
        <div style="flex: 1; min-width: 300px; padding: 0;">
            <img src="{{ car.image_url }}" style="width: 100%; height: 300px; object-fit: cover;">
            <div style="padding: 30px;">
                <h2 style="margin: 0 0 10px;">{{ car.name }}</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <span style="background: #eef2ff; color: #4f46e5; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">{{ car.category }}</span>
                    <span style="background: #eef2ff; color: #4f46e5; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">{{ car.transmission }}</span>
                    <span style="background: #eef2ff; color: #4f46e5; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">{{ car.seats }} Seats</span>
                </div>
                <p style="color: #666; line-height: 1.6;">
                    Experience premium comfort and performance. Perfect for weekend getaways or business trips.
                </p>
                <div style="font-size: 1.5rem; font-weight: 800; color: #333; margin-top: 20px;">
                    ₹{{ car.price_per_hr }}<span style="font-size: 0.9rem; color: #666; font-weight: normal;">/hour</span>
                </div>
            </div>
        </div>

        <div style="flex: 1; min-width: 300px; padding: 40px; background: #fff; border-left: 1px solid #eee;">
            <h3 style="margin-top: 0;">Plan Your Trip</h3>
            
            <form method="POST" action="{{ url_for('book_car_dates', car_id=car.id) }}">
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #444;">Pick-up Date & Time</label>
                    <input type="datetime-local" id="start_date" name="start_date" required 
                           style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #444;">Return Date & Time</label>
                    <input type="datetime-local" id="end_date" name="end_date" required 
                           style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;">
                </div>

                <div style="margin-bottom: 30px; display: flex; align-items: center; gap: 10px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <input type="checkbox" id="with_driver" name="with_driver" style="width: 20px; height: 20px;">
                    <label for="with_driver" style="cursor: pointer; font-weight: 600; color: #333;">Include Professional Driver (+₹500)</label>
                </div>

                <div style="background: #f1f5f9; padding: 20px; border-radius: 12px; margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Duration:</span>
                        <span id="duration_display">0 hours</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: 800; color: #333; border-top: 1px solid #ddd; padding-top: 10px;">
                        <span>Estimated Total:</span>
                        <span id="total_display">₹0</span>
                    </div>
                </div>

                <button type="submit" style="width: 100%; padding: 15px; background: #007bff; color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: background 0.2s;">
                    Proceed to Payment <i class="fas fa-arrow-right" style="margin-left: 10px;"></i>
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    // JavaScript to Calculate Price in Real-Time
    const startInput = document.getElementById('start_date');
    const endInput = document.getElementById('end_date');
    const driverInput = document.getElementById('with_driver');
    const durationDisplay = document.getElementById('duration_display');
    const totalDisplay = document.getElementById('total_display');
    
    const pricePerHour = {{ car.price_per_hr }};
    const tax = 648;

    function calculatePrice() {
        const start = new Date(startInput.value);
        const end = new Date(endInput.value);
        const withDriver = driverInput.checked;

        if (start && end && end > start) {
            const diffMs = end - start;
            const diffHrs = Math.ceil(diffMs / (1000 * 60 * 60)); // Round up hours
            
            let baseCost = diffHrs * pricePerHour;
            let driverCost = withDriver ? 500 : 0;
            let total = baseCost + driverCost + tax;

            durationDisplay.innerText = diffHrs + " hours";
            totalDisplay.innerText = "₹" + total;
        } else {
            durationDisplay.innerText = "0 hours";
            totalDisplay.innerText = "₹0";
        }
    }

    startInput.addEventListener('change', calculatePrice);
    endInput.addEventListener('change', calculatePrice);
    driverInput.addEventListener('change', calculatePrice);
</script>
{% endblock %}
